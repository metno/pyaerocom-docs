

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Colocating gridded data with discrete observations &mdash; pyaerocom  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="pyaerocom  documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> pyaerocom
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="readme.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme.html#website-and-code-documentation">Website and code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme.html#requirements">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme.html#access-to-users-database">Access to users database</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme.html#getting-started">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials (Jupyter Notebooks)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html#further-tutorials-in-depth">Further tutorials (in-depth)</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_testsuite.html">Tests (for developers)</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_files.html">Configuration files</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyaerocom</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Colocating gridded data with discrete observations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tut06_intro_colocation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="colocating-gridded-data-with-discrete-observations">
<h1>Colocating gridded data with discrete observations<a class="headerlink" href="#colocating-gridded-data-with-discrete-observations" title="Permalink to this headline">¶</a></h1>
<p>This notebook gives an introduction into collocation of gridded data
with observations. Here, the 550 nm AODs of the ECMWF CAMS reanalysis
model are compared with global daily AeroNet Sun V2 (Level 2) data for
the year 2010. The collocated data will be analysed and visualised in
monthly resolution. The analysis results will be plotted in the form of
the well known Aerocom loglog scatter plots as can be found in the
online interface (see e.g.
<a class="reference external" href="http://aerocom.met.no/cgi-bin/aerocom/surfobs_annualrs.pl">here</a>).</p>
<div class="section" id="import-setup-and-imports">
<h2>Import setup and imports<a class="headerlink" href="#import-setup-and-imports" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyaerocom</span> <span class="k">as</span> <span class="nn">pya</span>
<span class="n">pya</span><span class="o">.</span><span class="n">change_verbosity</span><span class="p">(</span><span class="s1">&#39;critical&#39;</span><span class="p">)</span>

<span class="n">YEAR</span> <span class="o">=</span> <span class="mi">2010</span>
<span class="n">VAR</span> <span class="o">=</span> <span class="s2">&quot;od550aer&quot;</span>
<span class="n">TS_TYPE</span> <span class="o">=</span> <span class="s2">&quot;daily&quot;</span>
<span class="n">MODEL_ID</span> <span class="o">=</span> <span class="s2">&quot;ECMWF_CAMS_REAN&quot;</span>
<span class="n">OBS_ID</span> <span class="o">=</span> <span class="s1">&#39;AeronetSunV3Lev2.daily&#39;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Init</span> <span class="n">data</span> <span class="n">paths</span> <span class="k">for</span> <span class="n">lustre</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.009945869445800781</span> <span class="n">s</span>
</pre></div>
</div>
</div>
<div class="section" id="import-of-model-data">
<h2>Import of model data<a class="headerlink" href="#import-of-model-data" title="Permalink to this headline">¶</a></h2>
<p>Create reader instance for model data and print overview of what is in
there.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_reader</span> <span class="o">=</span> <span class="n">pya</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">ReadGridded</span><span class="p">(</span><span class="n">MODEL_ID</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_reader</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Pyaerocom</span> <span class="n">ReadGridded</span>
<span class="o">---------------------</span>
<span class="n">Model</span> <span class="n">ID</span><span class="p">:</span> <span class="n">ECMWF_CAMS_REAN</span>
<span class="n">Data</span> <span class="n">directory</span><span class="p">:</span> <span class="o">/</span><span class="n">lustre</span><span class="o">/</span><span class="n">storeA</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">aerocom</span><span class="o">/</span><span class="n">aerocom</span><span class="o">-</span><span class="n">users</span><span class="o">-</span><span class="n">database</span><span class="o">/</span><span class="n">ECMWF</span><span class="o">/</span><span class="n">ECMWF_CAMS_REAN</span><span class="o">/</span><span class="n">renamed</span>
<span class="n">Available</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;ang4487aer&#39;</span><span class="p">,</span> <span class="s1">&#39;ec532aer3D&#39;</span><span class="p">,</span> <span class="s1">&#39;od440aer&#39;</span><span class="p">,</span> <span class="s1">&#39;od550aer&#39;</span><span class="p">,</span> <span class="s1">&#39;od550bc&#39;</span><span class="p">,</span> <span class="s1">&#39;od550dust&#39;</span><span class="p">,</span> <span class="s1">&#39;od550oa&#39;</span><span class="p">,</span> <span class="s1">&#39;od550so4&#39;</span><span class="p">,</span> <span class="s1">&#39;od550ss&#39;</span><span class="p">,</span> <span class="s1">&#39;od865aer&#39;</span><span class="p">]</span>
<span class="n">Available</span> <span class="n">years</span><span class="p">:</span> <span class="p">[</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">2004</span><span class="p">,</span> <span class="mi">2005</span><span class="p">,</span> <span class="mi">2006</span><span class="p">,</span> <span class="mi">2007</span><span class="p">,</span> <span class="mi">2008</span><span class="p">,</span> <span class="mi">2009</span><span class="p">,</span> <span class="mi">2010</span><span class="p">,</span> <span class="mi">2011</span><span class="p">,</span> <span class="mi">2012</span><span class="p">,</span> <span class="mi">2013</span><span class="p">,</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="mi">2018</span><span class="p">,</span> <span class="mi">9999</span><span class="p">]</span>
<span class="n">Available</span> <span class="n">time</span> <span class="n">resolutions</span> <span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="s1">&#39;monthly&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Since we are only interested in a single year we can use the method</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_data</span> <span class="o">=</span> <span class="n">model_reader</span><span class="o">.</span><span class="n">read_var</span><span class="p">(</span><span class="n">VAR</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">YEAR</span><span class="p">)</span>
<span class="c1">#model_data = read_result[VAR][YEAR]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_data</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jonasg</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">iris</span><span class="o">/</span><span class="n">fileformats</span><span class="o">/</span><span class="n">_pyke_rules</span><span class="o">/</span><span class="n">compiled_krb</span><span class="o">/</span><span class="n">fc_rules_cf_fc</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">2029</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">Gracefully</span> <span class="n">filling</span> <span class="s1">&#39;lat&#39;</span> <span class="n">dimension</span> <span class="n">coordinate</span> <span class="n">masked</span> <span class="n">points</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cf_coord_var</span><span class="o">.</span><span class="n">cf_name</span><span class="p">)))</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jonasg</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">iris</span><span class="o">/</span><span class="n">fileformats</span><span class="o">/</span><span class="n">_pyke_rules</span><span class="o">/</span><span class="n">compiled_krb</span><span class="o">/</span><span class="n">fc_rules_cf_fc</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">2029</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">Gracefully</span> <span class="n">filling</span> <span class="s1">&#39;lon&#39;</span> <span class="n">dimension</span> <span class="n">coordinate</span> <span class="n">masked</span> <span class="n">points</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cf_coord_var</span><span class="o">.</span><span class="n">cf_name</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyaerocom</span><span class="o">.</span><span class="n">GriddedData</span><span class="p">:</span> <span class="n">ECMWF_CAMS_REAN</span>
<span class="n">Grid</span> <span class="n">data</span><span class="p">:</span> <span class="n">Aerosol</span> <span class="n">optical</span> <span class="n">depth</span> <span class="n">at</span> <span class="mi">550</span> <span class="n">nm</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">time</span><span class="p">:</span> <span class="mi">365</span><span class="p">;</span> <span class="n">latitude</span><span class="p">:</span> <span class="mi">161</span><span class="p">;</span> <span class="n">longitude</span><span class="p">:</span> <span class="mi">320</span><span class="p">)</span>
     <span class="n">Dimension</span> <span class="n">coordinates</span><span class="p">:</span>
          <span class="n">time</span>                             <span class="n">x</span>              <span class="o">-</span>               <span class="o">-</span>
          <span class="n">latitude</span>                         <span class="o">-</span>              <span class="n">x</span>               <span class="o">-</span>
          <span class="n">longitude</span>                        <span class="o">-</span>              <span class="o">-</span>               <span class="n">x</span>
     <span class="n">Attributes</span><span class="p">:</span>
          <span class="n">Conventions</span><span class="p">:</span> <span class="n">CF</span><span class="o">-</span><span class="mf">1.6</span>
          <span class="n">NCO</span><span class="p">:</span> <span class="s2">&quot;4.5.4&quot;</span>
          <span class="n">history</span><span class="p">:</span> <span class="n">Sat</span> <span class="n">May</span> <span class="mi">26</span> <span class="mi">21</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">48</span> <span class="mi">2018</span><span class="p">:</span> <span class="n">ncecat</span> <span class="o">-</span><span class="n">O</span> <span class="o">-</span><span class="n">u</span> <span class="n">time</span> <span class="o">-</span><span class="n">n</span> <span class="mi">365</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span> <span class="n">CAMS_REAN_001</span><span class="o">.</span><span class="n">nc</span><span class="o">...</span>
          <span class="n">nco_openmp_thread_number</span><span class="p">:</span> <span class="mi">1</span>
     <span class="n">Cell</span> <span class="n">methods</span><span class="p">:</span>
          <span class="n">mean</span><span class="p">:</span> <span class="n">step</span>
          <span class="n">mean</span><span class="p">:</span> <span class="n">time</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">model_data</span><span class="o">.</span><span class="n">quickplot_map</span><span class="p">(</span><span class="n">time_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/tut06_intro_colocation_7_0.png" src="_images/tut06_intro_colocation_7_0.png" />
</div>
<div class="section" id="import-of-aeronet-sun-v3-data-level-2">
<h2>Import of AeroNet Sun V3 data (Level 2)<a class="headerlink" href="#import-of-aeronet-sun-v3-data-level-2" title="Permalink to this headline">¶</a></h2>
<p>Import Aeronet data and apply filter that selects only stations that are
located at altitudes between 0 and 1000 m.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obs_reader</span> <span class="o">=</span> <span class="n">pya</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">ReadUngridded</span><span class="p">(</span><span class="n">OBS_ID</span><span class="p">,</span> <span class="p">[</span><span class="n">VAR</span><span class="p">,</span> <span class="s1">&#39;ang4487aer&#39;</span><span class="p">])</span>
<span class="n">obs_data</span> <span class="o">=</span> <span class="n">obs_reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">filter_by_meta</span><span class="p">(</span><span class="n">altitude</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obs_data</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Found</span> <span class="n">Cache</span> <span class="n">match</span> <span class="k">for</span> <span class="n">AeronetSunV3Lev2</span><span class="o">.</span><span class="n">daily</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Pyaerocom</span> <span class="n">UngriddedData</span>
<span class="o">-----------------------</span>
<span class="n">Contains</span> <span class="n">networks</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;AeronetSunV3Lev2.daily&#39;</span><span class="p">]</span>
<span class="n">Contains</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;ang4487aer&#39;</span><span class="p">,</span> <span class="s1">&#39;od550aer&#39;</span><span class="p">]</span>
<span class="n">Contains</span> <span class="n">instruments</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sun_photometer&#39;</span><span class="p">]</span>
<span class="n">Total</span> <span class="n">no</span><span class="o">.</span> <span class="n">of</span> <span class="n">meta</span><span class="o">-</span><span class="n">blocks</span><span class="p">:</span> <span class="mi">1013</span>
<span class="n">Filters</span> <span class="n">that</span> <span class="n">were</span> <span class="n">applied</span><span class="p">:</span>
 <span class="n">Filter</span> <span class="n">time</span> <span class="n">log</span><span class="p">:</span> <span class="mi">20190131184530</span>
    <span class="n">altitude</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="plot-station-coordinates">
<h2>Plot station coordinates<a class="headerlink" href="#plot-station-coordinates" title="Permalink to this headline">¶</a></h2>
<p>First, plot all stations that are available at all times (as red dots),
then (on top of that in green), plot all stations that provide AODs in
2010.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">obs_data</span><span class="o">.</span><span class="n">plot_station_coordinates</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                       <span class="n">label</span><span class="o">=</span><span class="s1">&#39;All stations&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">obs_data</span><span class="o">.</span><span class="n">plot_station_coordinates</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;od550aer&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">2010</span><span class="p">,</span>
                                       <span class="n">filter_name</span><span class="o">=</span><span class="s1">&#39;WORLD-noMOUNTAINS&#39;</span><span class="p">,</span>
                                       <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Aeronet V3 stations&#39;</span><span class="p">,</span>
                                       <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span> <span class="c1">#just pass the GeoAxes instance that was created in the first call</span>
</pre></div>
</div>
<img alt="_images/tut06_intro_colocation_11_0.png" src="_images/tut06_intro_colocation_11_0.png" />
</div>
<div class="section" id="now-perform-collocation-and-plot-corresponding-scatter-plots-with-statistical-values">
<h2>Now perform collocation and plot corresponding scatter plots with statistical values<a class="headerlink" href="#now-perform-collocation-and-plot-corresponding-scatter-plots-with-statistical-values" title="Permalink to this headline">¶</a></h2>
<div class="section" id="monthly-world-no-mountains">
<h3>2010 monthly World no mountains<a class="headerlink" href="#monthly-world-no-mountains" title="Permalink to this headline">¶</a></h3>
<p>Colocate 2010 data in monthly resolution using (cf. green dots in
station plot above).</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obs_data</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UngriddedData</span> <span class="o">&lt;</span><span class="n">networks</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;AeronetSunV3Lev2.daily&#39;</span><span class="p">];</span> <span class="nb">vars</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;ang4487aer&#39;</span><span class="p">,</span> <span class="s1">&#39;od550aer&#39;</span><span class="p">];</span> <span class="n">instruments</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sun_photometer&#39;</span><span class="p">];</span><span class="n">No</span><span class="o">.</span> <span class="n">of</span> <span class="n">stations</span><span class="p">:</span> <span class="mi">1013</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_coloc</span> <span class="o">=</span> <span class="n">pya</span><span class="o">.</span><span class="n">colocation</span><span class="o">.</span><span class="n">colocate_gridded_ungridded</span><span class="p">(</span><span class="n">model_data</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">ts_type</span><span class="o">=</span><span class="s1">&#39;monthly&#39;</span><span class="p">,</span>
                                                       <span class="n">filter_name</span><span class="o">=</span><span class="s1">&#39;WORLD-noMOUNTAINS&#39;</span><span class="p">)</span>
<span class="n">data_coloc</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Interpolating</span> <span class="n">data</span> <span class="n">of</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">320</span><span class="p">)</span><span class="o">.</span> <span class="n">This</span> <span class="n">may</span> <span class="n">take</span> <span class="n">a</span> <span class="k">while</span><span class="o">.</span>
<span class="n">Successfully</span> <span class="n">interpolated</span> <span class="n">cube</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span> <span class="s1">&#39;od550aer&#39;</span> <span class="p">(</span><span class="n">data_source</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="n">station_name</span><span class="p">:</span> <span class="mi">278</span><span class="p">)</span><span class="o">&gt;</span>
<span class="n">array</span><span class="p">([[[</span>     <span class="n">nan</span><span class="p">,</span> <span class="mf">0.117588</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span> <span class="mf">0.222138</span><span class="p">],</span>
        <span class="p">[</span>     <span class="n">nan</span><span class="p">,</span> <span class="mf">0.132128</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span> <span class="mf">0.429762</span><span class="p">],</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="p">[</span><span class="mf">0.132236</span><span class="p">,</span> <span class="mf">0.195057</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span> <span class="mf">0.261765</span><span class="p">],</span>
        <span class="p">[</span>     <span class="n">nan</span><span class="p">,</span> <span class="mf">0.098409</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span> <span class="mf">0.37905</span> <span class="p">]],</span>

       <span class="p">[[</span><span class="mf">0.189948</span><span class="p">,</span> <span class="mf">0.140062</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.079353</span><span class="p">,</span> <span class="mf">0.204337</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.150408</span><span class="p">,</span> <span class="mf">0.190089</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.10622</span> <span class="p">,</span> <span class="mf">0.257806</span><span class="p">],</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="p">[</span><span class="mf">0.159844</span><span class="p">,</span> <span class="mf">0.178564</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.054091</span><span class="p">,</span> <span class="mf">0.239393</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.147172</span><span class="p">,</span> <span class="mf">0.138039</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.077916</span><span class="p">,</span> <span class="mf">0.19986</span> <span class="p">]]])</span>
<span class="n">Coordinates</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">data_source</span>   <span class="p">(</span><span class="n">data_source</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U22</span> <span class="s1">&#39;AeronetSunV3Lev2.daily&#39;</span> <span class="s1">&#39;ECMWF_CAMS_REAN&#39;</span>
    <span class="n">var_name</span>      <span class="p">(</span><span class="n">data_source</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U8</span> <span class="s1">&#39;od550aer&#39;</span> <span class="s1">&#39;od550aer&#39;</span>
  <span class="o">*</span> <span class="n">time</span>          <span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">2010</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">2010</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span> <span class="o">...</span>
  <span class="o">*</span> <span class="n">station_name</span>  <span class="p">(</span><span class="n">station_name</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U19</span> <span class="s1">&#39;ARM_Darwin&#39;</span> <span class="s1">&#39;ATHENS-NOA&#39;</span> <span class="s1">&#39;Agoufou&#39;</span> <span class="o">...</span>
    <span class="n">latitude</span>      <span class="p">(</span><span class="n">station_name</span><span class="p">)</span> <span class="n">float64</span> <span class="o">-</span><span class="mf">12.43</span> <span class="mf">37.97</span> <span class="mf">15.35</span> <span class="o">-</span><span class="mf">9.871</span> <span class="mf">42.02</span> <span class="o">...</span>
    <span class="n">longitude</span>     <span class="p">(</span><span class="n">station_name</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">130.9</span> <span class="mf">23.72</span> <span class="o">-</span><span class="mf">1.479</span> <span class="o">-</span><span class="mf">56.1</span> <span class="o">-</span><span class="mf">93.77</span> <span class="o">...</span>
    <span class="n">altitude</span>      <span class="p">(</span><span class="n">station_name</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">29.9</span> <span class="mf">130.0</span> <span class="mf">305.0</span> <span class="mf">277.0</span> <span class="mf">338.0</span> <span class="mf">49.0</span> <span class="o">...</span>
<span class="n">Attributes</span><span class="p">:</span>
    <span class="n">data_source</span><span class="p">:</span>      <span class="p">[</span><span class="s1">&#39;AeronetSunV3Lev2.daily&#39;</span><span class="p">,</span> <span class="s1">&#39;ECMWF_CAMS_REAN&#39;</span><span class="p">]</span>
    <span class="n">var_name</span><span class="p">:</span>         <span class="p">[</span><span class="s1">&#39;od550aer&#39;</span><span class="p">,</span> <span class="s1">&#39;od550aer&#39;</span><span class="p">]</span>
    <span class="n">ts_type</span><span class="p">:</span>          <span class="n">monthly</span>
    <span class="n">filter_name</span><span class="p">:</span>      <span class="n">WORLD</span><span class="o">-</span><span class="n">noMOUNTAINS</span>
    <span class="n">ts_type_src</span><span class="p">:</span>      <span class="n">daily</span>
    <span class="n">ts_type_src_ref</span><span class="p">:</span>  <span class="n">daily</span>
    <span class="n">start_str</span><span class="p">:</span>        <span class="mi">20100101</span>
    <span class="n">stop_str</span><span class="p">:</span>         <span class="mi">20101231</span>
    <span class="n">unit</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">data_level</span><span class="p">:</span>       <span class="n">colocated</span>
    <span class="n">revision_ref</span><span class="p">:</span>     <span class="mi">20181212</span>
    <span class="n">region</span><span class="p">:</span>           <span class="n">WORLD</span>
    <span class="n">lon_range</span><span class="p">:</span>        <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">]</span>
    <span class="n">lat_range</span><span class="p">:</span>        <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
    <span class="n">alt_range</span><span class="p">:</span>        <span class="p">[</span><span class="o">-</span><span class="mf">1000000.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_coloc</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x7f9604663860</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="_images/tut06_intro_colocation_16_1.png" src="_images/tut06_intro_colocation_16_1.png" />
</div>
<div class="section" id="daily-europe-no-mountains">
<h3>2010 daily Europe no mountains<a class="headerlink" href="#daily-europe-no-mountains" title="Permalink to this headline">¶</a></h3>
<p>Now perform colocation only over Europe. Starting with a station plot.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obs_data</span><span class="o">.</span><span class="n">plot_station_coordinates</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;od550aer&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">2010</span><span class="p">,</span>
                                  <span class="n">filter_name</span><span class="o">=</span><span class="s1">&#39;EUROPE-noMOUNTAINS&#39;</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Aeronet V3 stations&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">cartopy</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">geoaxes</span><span class="o">.</span><span class="n">GeoAxes</span> <span class="n">at</span> <span class="mh">0x7f96046984a8</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="_images/tut06_intro_colocation_18_1.png" src="_images/tut06_intro_colocation_18_1.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_coloc</span> <span class="o">=</span> <span class="n">pya</span><span class="o">.</span><span class="n">colocation</span><span class="o">.</span><span class="n">colocate_gridded_ungridded_2D</span><span class="p">(</span><span class="n">model_data</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">ts_type</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">,</span>
                                                             <span class="n">filter_name</span><span class="o">=</span><span class="s1">&#39;EUROPE-noMOUNTAINS&#39;</span><span class="p">)</span>
<span class="n">data_coloc</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Old</span> <span class="n">name</span> <span class="n">of</span> <span class="n">function</span> <span class="n">colocate_gridded_ungridded</span><span class="p">(</span><span class="n">still</span> <span class="n">works</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Interpolating</span> <span class="n">data</span> <span class="n">of</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">320</span><span class="p">)</span><span class="o">.</span> <span class="n">This</span> <span class="n">may</span> <span class="n">take</span> <span class="n">a</span> <span class="k">while</span><span class="o">.</span>
<span class="n">Successfully</span> <span class="n">interpolated</span> <span class="n">cube</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span> <span class="s1">&#39;od550aer&#39;</span> <span class="p">(</span><span class="n">data_source</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="n">station_name</span><span class="p">:</span> <span class="mi">89</span><span class="p">)</span><span class="o">&gt;</span>
<span class="n">array</span><span class="p">([[[</span><span class="mf">0.163447</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span>      <span class="n">nan</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.078648</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span>      <span class="n">nan</span><span class="p">],</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="p">[</span>     <span class="n">nan</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span>      <span class="n">nan</span><span class="p">],</span>
        <span class="p">[</span>     <span class="n">nan</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>      <span class="n">nan</span><span class="p">,</span>      <span class="n">nan</span><span class="p">]],</span>

       <span class="p">[[</span><span class="mf">0.086522</span><span class="p">,</span> <span class="mf">0.015151</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.075447</span><span class="p">,</span> <span class="mf">0.03005</span> <span class="p">],</span>
        <span class="p">[</span><span class="mf">0.067198</span><span class="p">,</span> <span class="mf">0.043074</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.103671</span><span class="p">,</span> <span class="mf">0.042999</span><span class="p">],</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="p">[</span><span class="mf">0.242585</span><span class="p">,</span> <span class="mf">0.186407</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.053797</span><span class="p">,</span> <span class="mf">0.011344</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.079498</span><span class="p">,</span> <span class="mf">0.122098</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.027066</span><span class="p">,</span> <span class="mf">0.019639</span><span class="p">]]])</span>
<span class="n">Coordinates</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">data_source</span>   <span class="p">(</span><span class="n">data_source</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U22</span> <span class="s1">&#39;AeronetSunV3Lev2.daily&#39;</span> <span class="s1">&#39;ECMWF_CAMS_REAN&#39;</span>
    <span class="n">var_name</span>      <span class="p">(</span><span class="n">data_source</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U8</span> <span class="s1">&#39;od550aer&#39;</span> <span class="s1">&#39;od550aer&#39;</span>
  <span class="o">*</span> <span class="n">time</span>          <span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="o">...</span>
  <span class="o">*</span> <span class="n">station_name</span>  <span class="p">(</span><span class="n">station_name</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U19</span> <span class="s1">&#39;ATHENS-NOA&#39;</span> <span class="s1">&#39;Andenes&#39;</span> <span class="s1">&#39;Arcachon&#39;</span> <span class="o">...</span>
    <span class="n">latitude</span>      <span class="p">(</span><span class="n">station_name</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">37.97</span> <span class="mf">69.28</span> <span class="mf">44.66</span> <span class="mf">45.76</span> <span class="mf">42.0</span> <span class="mf">43.93</span> <span class="o">...</span>
    <span class="n">longitude</span>     <span class="p">(</span><span class="n">station_name</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">23.72</span> <span class="mf">16.01</span> <span class="o">-</span><span class="mf">1.163</span> <span class="mf">3.111</span> <span class="o">-</span><span class="mf">4.603</span> <span class="o">...</span>
    <span class="n">altitude</span>      <span class="p">(</span><span class="n">station_name</span><span class="p">)</span> <span class="n">float64</span> <span class="mf">130.0</span> <span class="mf">379.0</span> <span class="mf">11.0</span> <span class="mf">423.0</span> <span class="mf">873.0</span> <span class="mf">32.0</span> <span class="o">...</span>
<span class="n">Attributes</span><span class="p">:</span>
    <span class="n">data_source</span><span class="p">:</span>      <span class="p">[</span><span class="s1">&#39;AeronetSunV3Lev2.daily&#39;</span><span class="p">,</span> <span class="s1">&#39;ECMWF_CAMS_REAN&#39;</span><span class="p">]</span>
    <span class="n">var_name</span><span class="p">:</span>         <span class="p">[</span><span class="s1">&#39;od550aer&#39;</span><span class="p">,</span> <span class="s1">&#39;od550aer&#39;</span><span class="p">]</span>
    <span class="n">ts_type</span><span class="p">:</span>          <span class="n">daily</span>
    <span class="n">filter_name</span><span class="p">:</span>      <span class="n">EUROPE</span><span class="o">-</span><span class="n">noMOUNTAINS</span>
    <span class="n">ts_type_src</span><span class="p">:</span>      <span class="n">daily</span>
    <span class="n">ts_type_src_ref</span><span class="p">:</span>  <span class="n">daily</span>
    <span class="n">start_str</span><span class="p">:</span>        <span class="mi">20100101</span>
    <span class="n">stop_str</span><span class="p">:</span>         <span class="mi">20101231</span>
    <span class="n">unit</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">data_level</span><span class="p">:</span>       <span class="n">colocated</span>
    <span class="n">revision_ref</span><span class="p">:</span>     <span class="mi">20181212</span>
    <span class="n">region</span><span class="p">:</span>           <span class="n">EUROPE</span>
    <span class="n">lon_range</span><span class="p">:</span>        <span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">70</span><span class="p">]</span>
    <span class="n">lat_range</span><span class="p">:</span>        <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">80</span><span class="p">]</span>
    <span class="n">alt_range</span><span class="p">:</span>        <span class="p">[</span><span class="o">-</span><span class="mf">1000000.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_coloc</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x7f961c14f4e0</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="_images/tut06_intro_colocation_20_1.png" src="_images/tut06_intro_colocation_20_1.png" />
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, met.no.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>